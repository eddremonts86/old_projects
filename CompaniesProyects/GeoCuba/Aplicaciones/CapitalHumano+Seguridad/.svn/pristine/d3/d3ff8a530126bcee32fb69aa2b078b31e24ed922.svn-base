function Deduciones(){
    this.__data_store_datos = null;
    this.Init = function()
    {
        var deduciones =
        {
            text: 'Deducciones',
            id: 'deduciones',
            iconCls: 'nomencladores',
            handler: Ext.Function.bind(this.ShowMainWindow, this)
        };
        App.InsertMenuItem('Operaciones',deduciones);
    }
    // ========================================================================//
    this.BuildMainPanel = function(filterObj)
    {
        this.__data_store_datos = App.BuildJsonStore('Deduciones.Deduciones.Tomar_datos_generales',{
            fields: [
                {name: 'empresa'},
                {name: 'agencia'},
                {name: 'area'},
                {name: 'id_trabajador'},
                {name: 'id_contrato'},
                {name: 'trabajador_nombre_completo'},
                {name: 'nombre_cargo'},
                {name: 'tipo_contrato'},
                {name: 'contrato_ff'},
                {name: 'contrato_fi'},
                {name: 'sist_pago'},
                {name: 'forma_pago'},
                {name: 'horario_trabajo'}

            ],
            groupField : 'area',
            proxy: {type: 'ajax',reader: {type: 'json',root: 'rows',totalProperty: 'results'}},
            //params:{select_unidad:select},
            autoLoad: false
        });
        var groupingFeature = Ext.create('Ext.grid.feature.Grouping',{startCollapsed:true, groupHeaderTpl: 'Área: {name}' + ' ({rows.length})'});
        var _grid = new Ext.grid.Panel({
                id: 'Deduciones_grid_id',
                height: App.GetDesktopHeigth() - 35,
                width: '100%',
                region: 'center',
                frame: true,
                selType: 'rowmodel',
                enableColumnResize: true,
                sortableColumns : false,
                columnLines:true,
                features: [groupingFeature],
                store: this.__data_store_datos,
                columns: [
                    {
                        header: 'Trabajador',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'trabajador_nombre_completo',
                        flex: 5
                    },
                    {
                        header: 'Manto a <br> Reducir',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'total',
                        width:80
                    },
                    {
                        header: 'Cargo',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'nombre_cargo',
                        flex: 5
                    },
                    {
                        header: 'Agencia',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'agencia',
                        flex: 5
                    },
                    {
                        header: 'Área',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'area',
                        flex: 5
                    },
                    {
                        header: 'Dedución',
                        menuDisabled: true,
                        sortable: false,
                        dataIndex: 'area',
                        flex: 2
                    },
                    {
                        xtype:'actioncolumn',
                        width:55,
                        header: 'Editar',
                        items: [{
                            iconCls:'run_build_file16',
                            tooltip: 'Editar deduciones',
                            handler: function(grid, rowIndex, colIndex) {
                                var info = grid.store.data.items[rowIndex].data;
                                console.log(info.id_trabajador);
                                console.log(info.id_contrato);
                                this.__data_store_datos1 = App.BuildJsonStore('Deduciones.Deduciones.CargarDatosDeducciones',{
                                    fields: [
                                        {name: 'nombre'},
                                        {name: 'limitado', type:'boolean'},
                                        {name: 'cuentas'},
                                        {name: 'cuenta'},
                                        {name: 'descuentos_id'},
                                        {name: 'primera',type:'int'},
                                        {name: 'descuento',type:'int'},
                                        {name: 'segunda',type:'int'},
                                        {name: 'codigo'}
                                    ],
                                    params:{id_trabaj:info.id_trabajador,id_cont:info.id_contrato},
                                    groupField : 'area',
                                    proxy: {type: 'ajax',reader: {type: 'json',root: 'rows',totalProperty: 'results'}},
                                    autoLoad: false
                                });
                                this.__data_store_datos2 = App.BuildJsonStore('Deduciones.Deduciones.CargarDeducciones',{
                                    fields: [
                                        {name: 'id'},
                                        {name: 'cuentas'},
                                        {name: 'nombre'},
                                        {name: 'primera',type:'int'},
                                        {name: 'descuento',type:'int'},
                                        {name: 'segunda',type:'int'}

                                    ],
                                    groupField : 'area',
                                    proxy: {type: 'ajax',reader: {type: 'json',root: 'rows',totalProperty: 'results'}},
                                    autoLoad: false
                                });
                                Ext.create('Ext.window.Window', {
                                    title: 'Definir Deducciones para : '+info.trabajador_nombre_completo,
                                    height: '80%',
                                    modal:true,
                                    width: '80%',
                                    layout: 'fit',
                                    items:[
                                           {xtype:'panel',
                                            layout:'column',
                                            height:'100%',
                                            items:[
                                            { columnWidth: 0.5,
                                              xtype: 'grid',
                                              title:'Todas las Cuentas',
                                              id:'general',
                                              border:true,
                                              name:'general',
                                              plugins: [Ext.create('Ext.grid.plugin.CellEditing', {clicksToEdit: 1 })],
                                              columns: [
                                                       {header: 'Cta/SubCta',menuDisabled: true,sortable : false,dataIndex: 'cuentas',width:100},
                                                       {header: 'Nombre',menuDisabled: true,sortable : false,dataIndex: 'nombre',flex:5},
                                                       {header: '1ra Quincena',menuDisabled: true,sortable : false,dataIndex: 'primera',flex:1,editor: {allowBlank: false}},
                                                       {header: '2da Quincena',menuDisabled: true,sortable : false,dataIndex: 'segunda',flex:1,editor: {allowBlank: false}},
                                                       {header: 'Por Descontar',menuDisabled: true,sortable : false,dataIndex:'descuento',flex:2,editor: {allowBlank: false}}
                                                       ],
                                              store: this.__data_store_datos2,
                                              listeners: {
                                                           afterrender: function() {this.__data_store_datos2.load({params:{start:0,limit:25}});},
                                                                            scope : this},
                                              tbar:[
                                                {
                                                    text : 'Guadar',
                                                    handler:function(){alert('Hola mundo')}
                                                }
                                              ]
                                            },
                                            {
                                               columnWidth: 0.5,
                                               xtype: 'grid',
                                               border:true,
                                               title:'Todas las Cuentas de:'+info.trabajador_nombre_completo,
                                               id:'personal',
                                               name:'personal',
                                               plugins: [Ext.create('Ext.grid.plugin.CellEditing', {clicksToEdit: 1 })],
                                               columns:[
                                                         // {header: 'Cta/SubCta',menuDisabled: true,sortable : false,dataIndex: 'codigo',width:100},
                                                          {header: 'Nombre',menuDisabled: true,sortable : false,dataIndex: 'cuenta',flex:5},
                                                          {header: '1ra Quincena',menuDisabled: true,sortable : false,dataIndex: 'primera',flex:1,editor: {allowBlank: false}},
                                                          {header: '2da Quincena',menuDisabled: true,sortable : false,dataIndex: 'segunda',flex:1,editor: {allowBlank: false}},
                                                          {header: 'Por Descontar',menuDisabled: true,sortable : false,dataIndex:'descuento',flex:2,editor: {allowBlank: false}}
                                                      ],
                                                tbar:[
                                                    {
                                                        text : 'Actualizar',
                                                        handler:function(){alert('Hola mundo')}
                                                    },
                                                    {

                                                        text : 'Eliminar',
                                                        handler:function(){alert('Hola mundo')}
                                                    }
                                                ],
                                               store: this.__data_store_datos1,
                                               listeners: {
                                                           afterrender: function() {this.__data_store_datos1.load({params:{start:0,limit:25}
                                                                        });
                                                                    },
                                                                    scope : this
                                                                }
                                                            }
                                            ]
                                            }
                                    ]
                                }).show();
                            }
                        }]
                    }

                ],
                viewConfig: {
                    forceFit: true
                },
                tbar: {
                    id: 'Deduciones_tbar_id',
                    items: ['-'],
                    height: 28
                },
                bbar: {
                    xtype: 'pagingtoolbar',
                    pageSize: 10,
                    store:  this.__data_store_datos,
                    displayInfo: true,
                    plugins: new Ext.ux.ProgressBarPager()
                },
                listeners: {
                    selectionchange: {
                        fn: function (View, selections, options) {
                            if (selections.length == 0) {
                                this.Disable('Puestos_trabajo_por_areaGestionar');
                            }
                            else {
                                this.Enable('Puestos_trabajo_por_areaGestionar');
                            }
                        },
                        scope: this
                    }
                }
            });
        var _panel = new Ext.Panel({
                title: 'Gestionar Puesto por Área',
                border: true,
                frame: true,
                layout: 'border',
                height: App.GetDesktopHeigth(),
                width: '100%',
                items: [_grid],
                listeners: {
                    afterrender: function() {
                        this.__data_store_datos.load({
                            params:{
                                start:0,
                                limit:25
                            }
                        });
                    },
                    scope : this
                }
            });
        return _panel;
    }
    // ========================================================================//
    this.Free = function()
    {
        this.__data_store_datos.removeAll(true);
        delete this.__data_store_datos;
        this.__data_store_datos = null;
    }
    // ========================================================================//
    this.ShowMainWindow = function()
    {
        App.ShowMainPanel(null);
    }
}
App.RegisterModule('Deduciones', new Deduciones());